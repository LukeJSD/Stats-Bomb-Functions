# Stats-Bomb-Functions
### Author: Luke Julian
### README Updated: 31/07/2023
## Summary
Created some functions that provide useful statistics, visuals, and easier to understand tables for Stats Bomb's free event data in R.
## Libraries
- StatsBombR
- ggplot2
- grid
- tidyverse
## Functions
- get.competitionEvents(id.c, id.s)
  - id.c: Competition id (Women's World Cup = 72, EPL = 2, La Liga = 11, etc.)
  - id.s: Season id (2015/16 = 27, 2003/04 = 4, etc.)
  - Use the StatsBombR function FreeCompetitions() to get all of the freely available competition details
  - The StatsBombR functions for getting all the matches in one call was not working, so made this function for getting lots of matches in 1 data.frame.
  - Some notes on the calls on this function in the main.R setup:
    - The 15/16 EPL season, 2019 World Cup, and 2022 Euros include every match from every team
    - The 03/04 EPL season only has Arsenal matches (Invincibles)
    - La Liga has pretty much every Barcelona match during the Messi era, but is missing most everything else. Have found only one season with all the Real Madrid games (15/16)
- get.minutesplayed.custom(df, match.id=NULL)
  - df: data.frame of all the events in a match
  - match.id: currently not implemented
  - The builtin StatsBombR function for getting minutes played was not working, so made this.
  - Right now only works when df is only 1 match
- plot.teamDefense(df, leag_yr, doPlot=T)
  - df: all the events from a competition
  - leag_yr: year of the season being plotted
  - doPlot: Plot the ggplot if true, only return the plot is false
  - Plots a defensive heatmap of every team a competition for a season
  - Taken directly from the StatsBomb's guide to working with their R library
    - https://statsbomb.com/wp-content/uploads/2021/11/Working-with-R.pdf
- plot.Passes_CompletedBox(player_id, player_name, doPlot=T)
  - player_id: unique id for a desired player
  - player_name: the actual string name of the player
  - doPlot: Plot the ggplot if true, only return the plot is false
  - Plots all of player's completed passes where it was received in the attacking box
  - Taken directly from the StatsBomb's guide to working with their R library
    - https://statsbomb.com/wp-content/uploads/2021/11/Working-with-R.pdf
- get.PPDA(df, tm.id)
  - df: data.frame of all given events
    - Generally all the events from a given match
  - tm.id: unique team id of the desired team
  - Returns the Passes-Per-Defensive-Action of a team from a given set of events in df
  - PPDA is defined as opponent passes completed divided by the number of defensive actions made by the team
    - Defensive actions are:
      - Attempted tackle
      - Interception
      - Foul Committed
    - Only events that take place in the attacking 60% of the pitch
    - Great for measuring a team's pressing intensity
- TODO: get.DefAction.AvgXLoc
    - See how high up the pitch a team is pressing
- plot.ball_recoveries(df, plr.id)
  - df: data.frame of all given events
  - plr.id: unique player id for the observed player
  - Useful for finding great ball-winners and defensive midfielders (ie Kante)
- get.player.positions(df)
  - df: data.frame of all given events
  - Get all the positions the players in the data set played
  - Returns a data.frame with player.id, player.name, and list of positions for each row
- get.player.primaryPosition(df)
  - df: data.frame of all given events
  - Get players' main position
  - Assuming that the position that a player performs the most recorded events is their primary position
    - Could be a flawed method
    - Might be more accurate to use time spent at each position
    - Current method simpler
- Position utilities:
  - get.defense.id(): returns the position ids that are defense positions
  - get.midfield.id(): returns the position ids that are midfield positions
  - get.attack.id(): returns the position ids that are forward positions
  - get.positionRectangle(pos.id): used for highlighting a position when plotting on a pitch
- dist_to_gl(x, y)
  - Returns the scalar value of how far a pitch location is from the goal line
  - Used for progressive passes
- is.boxEntry(x0, y0, x1, y1)
  - _0: Pass location
  - _1: Receiver location
  - Returns a boolean on whether or not a given pass started outside the attacking box and was completed inside it
- get.progressivePasses(df)
  - df: data.frame of all given events
  - Returns a data.frame of the completed pass events (attacking 60% of pitch) with progressive passes recorded as TRUE for a progressive pass and NA when not
  - There are differing definitions for a progressive pass
    - The FBref definition is written but commented out
    - Currently defining a progP as a pass that move the ball at least 25% closer to goal or a box entry. Passes in the defending 40% of the pitch are not included
- plot.progressivePasses(df)
  - df: data.frame of all given events
  - Plot all of the progressive passes in df
  - Intended for passes by only one player, but works as long as the data set has the pass.progressive feature from get.progressivePasses
- plot.passingNetwork(df, mt.id, tm)
  - df: data.frame of all given events
  - mt.id: unique id for a single match
  - tm: unique team id
  - Plots a passing network from a single game
  - Only of starting eleven; cuts off at first sub for the observed team
  - Passes scaled to per-90-minutes
  - Paths between players are drawn when there are at least 5 passes-per90 from player 1 to player 2
    - Segment width represents passes per 90 from player 1 to player 2
  - Nodes represent each player
    - Size of each player node represents number of total passes per90
    - Position is the at the average x and average y of all completed passes
- save.passingNetwork.team_comp(df, tm.id)
  - df: data.frame of all given events
  - tm.id: unique team id
  - Saves passing network plots (see plt.passingNetwork) for all the matches in a team's season into a folder
- get.match_info(df)
  - df: data.frame of all given events
  - Get a data.frame that summarises matches
  - Stats:
    - Goals scored
    - Total xg
    - Shots attempted
    - Passes attempted
    - Passes completed
## Notes
- Hardcoded the directory of the project on my machine in main.R
- Plots are saved as PNG files
- testing.R is just a mess of code to try out the functions and see how they're working
